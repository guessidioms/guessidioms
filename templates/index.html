{% extends 'base.html' %}
{% from 'macros.html' import qux %}

{% block content %}
{% set name='baz' %}


<h1>Sample Page</h1>

An algorithm engineer CAN do frontend, but VERY VERY UGLY.


<script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.2/dist/hanzi-writer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cnchar-all/cnchar.all.min.js"></script>

<p id="target0"></p>
<p id="target1"></p>
<p id="target2"></p>
<p id="target3"></p>

<script>
    function renderFanningStrokes(target, strokes) {
        var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.style.width = '75px';
        svg.style.height = '75px';
        svg.style.border = '1px solid #EEE'
        svg.style.marginRight = '3px'
        target.appendChild(svg);
        var group = document.createElementNS('http://www.w3.org/2000/svg', 'g');

        // set the transform property on the g element so the character renders at 75x75
        var transformData = HanziWriter.getScalingTransform(75, 75);
        group.setAttributeNS(null, 'transform', transformData.transform);
        svg.appendChild(group);

        strokes.forEach(function(strokePath) {
            var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttributeNS(null, 'd', strokePath);
            // style the character paths
            path.style.fill = '#555';
            group.appendChild(path);
        });
    }

    function renderStrokes(chars, strokes, id) {
        var target = document.getElementById(id);
        function renderChar (i) {
            var thisStrokes = strokes[i]
            var thisChar = chars[i]
            var id = 'target' + i
            var strokeName = cnchar.stroke(thisChar, 'order')[0];
            HanziWriter.loadCharacterData(thisChar).then(function(charData) {
                if(strokeName.length != charData.strokes.length) {
                    alert("inner data mismatch, stroke name length != char data length")
                    return
                }
                var target = document.getElementById(id);
                var toRender = []
                for (var i = 0; i < charData.strokes.length; i++) {
                    if(thisStrokes.includes(strokeName[i])) {
                        toRender.push(charData.strokes[i])
                    }
                }
                renderFanningStrokes(target, toRender);
            });            
        }
        for (var i = 0; i < chars.length; i++) {
            renderChar(i)
        }
    }

    renderStrokes("花好月圆", ['jf', 'jf', 'jf', 'jf'], 'target')
</script>

{% endblock %}
